<ion-header>
  <ion-toolbar [color]="data?.status !== 'created' ? 'dark' : 'primary'">
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title> Detalle de orden</ion-title>
    <ion-buttons slot="end">
      <ion-button routerLink="/home">
        <ion-icon slot="icon-only" name="home"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
  <ion-toolbar color="success" *ngIf="data?.status === 'in-progress'">
    <ion-title>
      <p class="blink">Orden en camino de entrega</p>
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-header translucent *ngIf="data?.status === 'cancelled'">
  <ion-toolbar color="danger">
    <ion-title>Orden cancelada</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="resetOrderConfirm()" [disabled]="isLoading == true">
        <ion-icon slot="start" name="reload-outline"></ion-icon>
        <small
          >Solicitar <br />
          nuevamente</small
        >
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-header translucent *ngIf="data?.status === 'canceled-delivery'">
  <ion-toolbar color="danger">
    <ion-title>Entrega cancelada</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="resetOrderConfirm()" [disabled]="isLoading == true">
        <ion-icon slot="start" name="reload-outline"></ion-icon>
        <small
          >Solicitar <br />
          nuevamente</small
        >
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-header translucent *ngIf="data?.status === 'delivered'">
  <ion-toolbar color="tertiary">
    <ion-title>Orden entregada</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content color="light" *ngIf="data?.status === 'created'">
  <ion-grid fixed>
    <ion-row>
      <ion-col size="12">
        <ion-text color="primary">
          <h2><ion-icon slot="start" name="golf"></ion-icon> Lugar de entrega</h2>
        </ion-text>

        <ion-card *ngIf="data?.customer?.id; else addCustomer">
          <ion-card-header>
            <ion-card-title>
              <ion-toolbar class="ion-no-padding">
                {{ data?.customer?.name }}
                <ion-buttons slot="end">
                  <ion-button color="medium" (click)="deleteCustomerFunc()">
                    <ion-icon slot="icon-only" name="trash"></ion-icon>
                  </ion-button>
                  <ion-button color="medium" (click)="addCustomerFunc()">
                    <ion-icon slot="icon-only" name="repeat"></ion-icon>
                  </ion-button>
                </ion-buttons>
              </ion-toolbar>
            </ion-card-title>
            <ion-card-subtitle>
              <p><strong>Folio: </strong>{{ data?.customer?.folio }}</p>
              <p>{{ data?.customer?.phone }}</p>
              <p><ion-icon name="location" slot="start"></ion-icon> {{ data?.customer?.streetAddress }}</p>
              <p>{{ data?.customer?.references }}</p>
            </ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <ion-list>
              <ion-radio-group [(ngModel)]="deliveryType" (ionChange)="deliveryLocationChange()">
                <ion-list-header>
                  <ion-label>
                    Lugar de entrega
                  </ion-label>
                </ion-list-header>
                <ion-item>
                  <ion-label>
                    <div class="ion-text-wrap">
                      {{ data?.customer?.streetAddress }}
                    </div>
                  </ion-label>
                  <ion-radio slot="start" value="default" [disabled]="!canSelect"></ion-radio>
                </ion-item>
                <ion-item>
                  <ion-label>Otro</ion-label>
                  <ion-radio slot="start" value="other" [disabled]="!canSelect"></ion-radio>
                </ion-item>
              </ion-radio-group>
            </ion-list>
            <div *ngIf="deliveryType === 'other'">
              <ion-item>
                <ion-label position="stacked">Agregar lugar de entrega</ion-label>
                <ion-textarea rows="3" [(ngModel)]="deliveryLocation" placeholder="Especifique el lugar de entrega...">
                </ion-textarea>
              </ion-item>
              <ion-item>
                <ion-label position="stacked">Agregar referencia</ion-label>
                <ion-textarea
                  rows="3"
                  [(ngModel)]="deliveryLocationReferences"
                  placeholder="Agregar alguna referencia al lugar de entrega..."
                ></ion-textarea>
              </ion-item>
            </div>
          </ion-card-content>
        </ion-card>

        <ion-text color="primary">
          <h2><ion-icon slot="start" name="location"></ion-icon> Lugar de recolección</h2>
        </ion-text>
        <ion-card>
          <ion-card-header> </ion-card-header>
          <ion-card-content>
            <ion-item>
              <ion-label>User direccion por defecto</ion-label>
              <ion-checkbox slot="end" [(ngModel)]="checked" (ionChange)="pickupLocationDefault($event)">
              </ion-checkbox>
            </ion-item>

            <div *ngIf="pickupType === 'other'">
              <ion-item>
                <ion-label position="stacked">Agregar lugar de recolección</ion-label>
                <ion-textarea
                  rows="3"
                  [(ngModel)]="pickupLocation"
                  placeholder="Especifique el lugar de recolección..."
                  [disabled]="!canSelect"
                >
                </ion-textarea>
              </ion-item>
              <ion-item>
                <ion-label position="stacked">Agregar referencia</ion-label>
                <ion-textarea
                  rows="3"
                  [(ngModel)]="pickupLocationReferences"
                  placeholder="Agregar alguna referencia al lugar de recolección..."
                  [disabled]="!canSelect"
                ></ion-textarea>
              </ion-item>
            </div>
          </ion-card-content>
        </ion-card>

        <ng-template #addCustomer>
          <ion-card>
            <ion-card-header>
              <ion-card-title>
                <ion-toolbar class="ion-no-padding">
                  Sin cliente
                  <ion-buttons slot="end">
                    <ion-button color="medium" (click)="addCustomerFunc()">
                      <ion-icon slot="icon-only" name="add"></ion-icon>
                    </ion-button>
                  </ion-buttons>
                </ion-toolbar>
              </ion-card-title>
              <ion-card-subtitle color="medium">Sin información de cliente</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
              <ion-list>
                <ion-item>
                  <ion-label position="stacked">Agregar lugar de entrega</ion-label>
                  <ion-textarea
                    rows="3"
                    [(ngModel)]="deliveryLocation"
                    placeholder="Especifique el lugar de entrega..."
                  >
                  </ion-textarea>
                </ion-item>
                <ion-item>
                  <ion-label position="stacked">Agregar referencia</ion-label>
                  <ion-textarea
                    rows="3"
                    [(ngModel)]="deliveryLocationReferences"
                    placeholder="Agregar alguna referencia al lugar de entrega..."
                  ></ion-textarea>
                </ion-item>
              </ion-list>
            </ion-card-content>
          </ion-card>
        </ng-template>

        <ion-card>
          <ion-card-content>
            <ion-list>
              <ion-item>
                <ion-label class="ion-text-wrap">
                  <strong>
                    Costo de envío
                  </strong>
                </ion-label>
                <ion-input
                  slot="end"
                  class="ion-text-end"
                  type="number"
                  [(ngModel)]="shippingPrice"
                  placeholder="Costo de envío"
                  min="0"
                  (ionChange)="calculate()"
                >
                </ion-input>
              </ion-item>
              <ion-item lines="none">
                <ion-label>
                  <h1>
                    <strong>
                      Total
                    </strong>
                  </h1>
                </ion-label>
                <ion-label class="ion-text-end">
                  <h1>
                    {{ total | currency: 'USD' }}
                  </h1>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>

        <ion-text color="primary">
          <h2><ion-icon slot="start" name="bicycle"></ion-icon> Repartidor</h2>
        </ion-text>

        <ion-card *ngIf="data?.deliverer?.id; else addDeliverer">
          <ion-card-header>
            <ion-card-title>
              <ion-toolbar class="ion-no-padding">
                {{ data?.deliverer?.name }}
                <ion-buttons slot="end">
                  <ion-button color="medium" (click)="addDelivererFunc()">
                    <ion-icon slot="icon-only" name="repeat"></ion-icon>
                  </ion-button>
                </ion-buttons>
              </ion-toolbar>
            </ion-card-title>
            <ion-card-subtitle>
              <p><strong>Folio: </strong>{{ data?.deliverer?.folio }}</p>
              <p>{{ data?.deliverer?.phone }}</p>
            </ion-card-subtitle>
          </ion-card-header>
        </ion-card>

        <ng-template #addDeliverer>
          <ion-card>
            <ion-card-header>
              <ion-card-title>
                <ion-toolbar class="ion-no-padding">
                  Sin repartidor
                  <ion-buttons slot="end">
                    <ion-button color="medium" (click)="addDelivererFunc()">
                      <ion-icon slot="icon-only" name="add"></ion-icon>
                    </ion-button>
                  </ion-buttons>
                </ion-toolbar>
              </ion-card-title>
              <ion-card-subtitle color="medium">Agregar repartidor</ion-card-subtitle>
            </ion-card-header>
          </ion-card>
        </ng-template>
        <ion-button fill="clear" expand="block" (click)="cancelOrderConfirm()">
          <ion-icon slot="start" name="close"></ion-icon>
          Cancelar orden
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>

<ion-content
  color="light"
  *ngIf="
    data?.status === 'in-progress' ||
    data?.status === 'cancelled' ||
    data?.status === 'canceled-delivery' ||
    data?.status === 'delivered'
  "
>
  <ion-grid fixed>
    <ion-row>
      <ion-col size="12">
        <ion-text color="primary">
          <h2><ion-icon slot="start" name="calendar"></ion-icon> Fecha</h2>
        </ion-text>

        <ion-card>
          <ion-card-header>
            <ion-card-title>
              <strong>
                Fecha
              </strong>
            </ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div *ngIf="data.status === 'delivered'">
              <p><strong>Inicio: </strong> {{ data?.startDateStr }}</p>
              <p><strong>Entrega: </strong> {{ data?.finishDateStr }}</p>
            </div>
            <div *ngIf="data.status === 'in-progress'">
              <p><strong>Inicio: </strong> {{ data?.startDateStr }}</p>
            </div>

            <div *ngIf="data.status === 'canceled-delivery'">
              <p><strong>Inicio: </strong> {{ data?.startDateStr }}</p>
              <p><strong>Cancelación: </strong> {{ data?.finishDateStr }}</p>
            </div>

            <div *ngIf="data.status === 'cancelled'">
              <p><strong>Creación: </strong> {{ data?.dateStr }}</p>
              <p><strong>Cancelación: </strong> {{ data?.finishDateStr }}</p>
            </div>

            <div *ngIf="data.status === 'created'">
              <p><strong>Creación: </strong> {{ data?.dateStr }}</p>
            </div>
          </ion-card-content>
        </ion-card>

        <ion-text color="primary">
          <h2><ion-icon slot="start" name="location"></ion-icon>Lugar de recolección</h2>
        </ion-text>

        <ion-card>
          <ion-card-header>
            <ion-card-subtitle color="medium">
              <p>
                <ion-icon name="location" slot="start"></ion-icon>
                {{ pickupLocation }}
              </p>
              <p>{{ pickupLocationReferences }}</p>
            </ion-card-subtitle>
          </ion-card-header>
          <ion-card-content> </ion-card-content>
        </ion-card>

        <ion-text color="primary">
          <h2><ion-icon slot="start" name="golf"></ion-icon> Lugar de entrega</h2>
        </ion-text>

        <ion-card *ngIf="data?.customer?.id; else detailCustomer">
          <ion-card-header>
            <ion-card-title>
              {{ data?.customer?.name }}
            </ion-card-title>
            <ion-card-subtitle>
              <p><strong>Folio: </strong>{{ data?.customer?.folio }}</p>
              <p>{{ data?.customer?.phone }}</p>
            </ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <p>
              <ion-icon name="location" slot="start"></ion-icon>
              {{ deliveryLocation }}
            </p>
            <p>{{ deliveryLocationReferences }}</p>
          </ion-card-content>
        </ion-card>

        <ng-template #detailCustomer>
          <ion-card>
            <ion-card-header>
              <ion-card-title>
                Sin cliente
              </ion-card-title>
              <ion-card-subtitle color="medium">Sin información de cliente</ion-card-subtitle>
            </ion-card-header>
            <ion-card-content>
              <p *ngIf="noCustomerData === '1'">
                Se asignará al llegar a empresa
              </p>
            </ion-card-content>
          </ion-card>
        </ng-template>

        <ion-text color="primary">
          <h2><ion-icon slot="start" name="bicycle"></ion-icon> Repartidor</h2>
        </ion-text>

        <ion-card>
          <ion-card-header>
            <ion-card-title>
              {{ data?.deliverer?.name }}
            </ion-card-title>
            <ion-card-subtitle>
              <p><strong>Folio: </strong>{{ data?.deliverer?.folio }}</p>
              <p>{{ data?.deliverer?.phone }}</p>
            </ion-card-subtitle>
          </ion-card-header>
          <ion-card-content *ngIf="data?.status === 'in-progress'">
            <ion-button color="primary" (click)="sendInformationToDelvererCheck()">
              <ion-icon slot="start" name="logo-whatsapp"></ion-icon>
              Enviar información al repartidor
            </ion-button>
          </ion-card-content>
        </ion-card>

        <ion-card>
          <ion-card-content>
            <ion-list>
              <ion-item>
                <ion-label class="ion-text-wrap">
                  <strong>
                    Costo de envío
                  </strong>
                </ion-label>
                <ion-label slot="end" class="ion-text-end">
                  {{ shippingPrice | currency: 'USD' }}
                </ion-label>
              </ion-item>
              <ion-item lines="none">
                <ion-label>
                  <h1>
                    <strong>
                      Total
                    </strong>
                  </h1>
                </ion-label>
                <ion-label class="ion-text-end">
                  <h1>
                    {{ total | currency: 'USD' }}
                  </h1>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>

<ion-footer color="light" *ngIf="data?.status === 'created'">
  <ion-toolbar>
    <ion-grid fixed>
      <ion-row>
        <ion-col size="6">
          <ion-button color="primary" fill="outline" expand="block" (click)="save(true)" [disabled]="isLoading">
            <ion-icon slot="start" name="save"></ion-icon>
            Guardar
          </ion-button>
        </ion-col>
        <ion-col size="6">
          <ion-button color="primary" expand="block" (click)="startOrderConfirm()" [disabled]="isLoading">
            <ion-icon slot="start" name="bicycle"></ion-icon>
            Iniciar entrega
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-footer>

<ion-footer color="light" *ngIf="data?.status === 'in-progress'">
  <ion-toolbar>
    <ion-grid fixed>
      <ion-row>
        <ion-col size="6">
          <ion-button
            color="primary"
            expand="block"
            class="ion-text-wrap"
            (click)="orderDeliveredConfirm()"
            [disabled]="isLoading"
          >
            <ion-icon slot="end" name="checkmark-circle-outline"></ion-icon>
            <small>Orden entregada</small>
          </ion-button>
        </ion-col>
        <ion-col size="6">
          <ion-button
            color="primary"
            fill="outline"
            expand="block"
            class="ion-text-wrap"
            (click)="cancelDeliveryConfirm()"
            [disabled]="isLoading"
          >
            <ion-icon slot="end" name="close-circle-outline"></ion-icon>
            <small>Cancelar entrega</small>
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-footer>
